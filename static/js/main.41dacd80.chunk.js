(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,a){e.exports=a.p+"static/media/logo.ee7cd8ed.svg"},126:function(e,t,a){e.exports=a(256)},131:function(e,t,a){},132:function(e,t,a){},140:function(e,t){},142:function(e,t){},256:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(99),s=a.n(l),o=(a(131),a(37)),i=a(38),u=a(42),c=a(39),h=a(43),p=a(100),f=a.n(p),g=(a(132),a(7)),d=a.n(g),v=a(25),b=a(44),w=a.n(b),m=a(259),j=w.a.DataFactory,E=j.namedNode,k=(j.literal,j.defaultGraph,j.quad,function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(c.a)(t).call(this,e))).DATASET_URL="https://lodi.ilabt.imec.be/observer/rawdata/latest",a.sg="https://opentrafficlights.org/id/signalgroup/K648/1",a.SPEED=0,a.first=!0,a.signalgroups=[],a.prevGatGreen=[],a.lastGat=null,a.iLastGat=null,a.nextLastGat=null,a.AMOUNT_OF_FRAGMENTS=15,a.vertreklanen={},a.data={},a.lanes={},a.state={laneValues:{}},a}return Object(h.a)(t,e),Object(i.a)(t,[{key:"sleep",value:function(e){return new Promise(function(t){return setTimeout(t,e)})}},{key:"initConfiguration",value:function(e){var t=this;console.log("initConfiguration");var a={};e.getQuads(null,E("https://w3id.org/opentrafficlights#departureLane"),null).forEach(function(n){e.getQuads(n.object,E("http://purl.org/dc/terms/description"),null).forEach(function(n){e.getQuads(null,E("https://w3id.org/opentrafficlights#departureLane"),n.subject).forEach(function(r){var l=e.getQuads(r.subject,E("https://w3id.org/opentrafficlights#signalGroup"),null)[0].object.value;console.log("signalGroup");var s=e.getQuads(r.subject,E("https://w3id.org/opentrafficlights#signalGroup"),null)[0].object.value;console.log(s),e.getQuads(r.subject,E("https://w3id.org/opentrafficlights#arrivalLane"),null).forEach(function(r){e.getQuads(r.object,E("http://purl.org/dc/terms/description"),null).forEach(function(e){t.vertreklanen[n.subject.value]||(t.vertreklanen[n.subject.value]=[]),t.vertreklanen[n.subject.value][r.object.value]={"@id":r.object.value,"http://purl.org/dc/terms/description":e.object.value,"https://w3id.org/opentrafficlights#signalGroup":l},a[n.subject.value]||(a[n.subject.value]={}),a[n.subject.value][r.object.value]=["initial","initial"],t.lanes[r.object.value]||(t.lanes[r.object.value]=e.object.value)})}),t.lanes[n.subject.value]||(t.lanes[n.subject.value]=n.object.value)})})}),this.setState({lanes:this.vertreklanen,laneValues:a})}},{key:"getSignalgroups",value:function(){var e=Object(v.a)(d.a.mark(function e(t){var a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,t.getQuads(null,E("http://www.w3.org/2000/01/rdf-schema#type"),E("https://w3id.org/opentrafficlights#Signalgroup")).forEach(function(e){a.push(e.subject.value)});case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"download",value:function(e){return new Promise(function(t){fetch(e).then(function(e){return e.text()}).then(function(e){t(e)})})}},{key:"parseAndStoreQuads",value:function(e){return new Promise(function(t){var a=new w.a.Parser,n=w.a.Store();a.parse(e,function(e,a,r){if(!a)return t(n);n.addQuad(a)})})}},{key:"calcHistoricData",value:function(){var e=Object(v.a)(d.a.mark(function e(t){var a=this;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.getQuads(null,E("http://www.w3.org/ns/prov#generatedAtTime"),null).sort(function(e,t){return(e=new Date(e.object.value).getTime())>(t=new Date(t.object.value).getTime())?-1:e<t?1:0}).forEach(function(e){var n=new Date(e.object.value);n!==a.lastGat&&(a.lastGat=n),t.getQuads(null,E("https://w3id.org/opentrafficlights#signalState"),null,e.subject).forEach(function(r){var l,s=r.subject.value;"https://w3id.org/opentrafficlights/thesauri/signalphase/6"===t.getQuads(r.object,E("https://w3id.org/opentrafficlights#signalPhase"),null,e.subject)[0].object.value&&(a.prevGatGreen[s]=n,l=0),null!=a.prevGatGreen[s]&&(l=(a.prevGatGreen[s].getTime()-n.getTime())/1e3)<100&&(a.data[s]||(a.data[s]=[]),a.data[s].unshift({generatedAtTime:new Date(n),timeTillGreen:l}))})});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(v.a)(d.a.mark(function e(){var t,a,n,r,l=this;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("async funtion start"),e.next=3,this.download(this.DATASET_URL);case 3:return t=e.sent,e.next=6,this.parseAndStoreQuads(t);case 6:return a=e.sent,e.next=9,this.getSignalgroups(a);case 9:this.signalgroups=e.sent,this.initConfiguration(a),this.signalgroups.forEach(function(e){l.prevGatGreen[e]=null,l.data[e]=[]});case 12:return e.next=15,this.calcHistoricData(a);case 15:this.showLatest(a),n=0,r=a.getQuads(null,E("http://www.w3.org/ns/hydra/core#previous"),null)[0];case 18:if(!(r&&n<this.AMOUNT_OF_FRAGMENTS)){e.next=31;break}return n++,e.next=22,this.download(r.object.value);case 22:return t=e.sent,e.next=25,this.parseAndStoreQuads(t);case 25:return a=e.sent,e.next=28,this.calcHistoricData(a);case 28:r=a.getQuads(null,E("http://www.w3.org/ns/hydra/core#previous"),null)[0],e.next=18;break;case 31:return e.next=33,this.download(this.DATASET_URL);case 33:return t=e.sent,e.next=36,this.parseAndStoreQuads(t);case 36:return a=e.sent,this.signalgroups.forEach(function(e){l.prevGatGreen[e]=null,l.data[e]=[]}),e.next=40,this.sleep(this.SPEED);case 40:e.next=12;break;case 42:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"showLatest",value:function(){var e=Object(v.a)(d.a.mark(function e(t){var a,n,r,l,s;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=t.getQuads(null,E("http://www.w3.org/ns/prov#generatedAtTime"),null),n=a.sort(function(e,t){return(e=new Date(e.object.value).getTime())>(t=new Date(t.object.value).getTime())?-1:e<t?1:0})[0],r=n.object.value,l=this,s=this.state.laneValues,Object.keys(this.vertreklanen).forEach(function(e){Object.keys(l.vertreklanen[e]).forEach(function(a){var o=l.vertreklanen[e][a]["https://w3id.org/opentrafficlights#signalGroup"],i=t.getQuads(E(o),E("https://w3id.org/opentrafficlights#signalState"),null,n.subject)[0];if(i){var u=t.getQuads(i.object,E("https://w3id.org/opentrafficlights#minEndTime"),null,n.subject)[0],c=t.getQuads(i.object,E("https://w3id.org/opentrafficlights#maxEndTime"),null,n.subject)[0],h=t.getQuads(i.object,E("https://w3id.org/opentrafficlights#signalPhase"),null,n.subject)[0],p=Math.round((new Date(u.object.value).getTime()-new Date(r).getTime())/1e3);u.object.value===c.object.value?s[e][a]=[p,h.object.value]:s[e][a]=[">"+p,h.object.value]}})}),this.setState({laneValues:s});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"showCounterLabel",value:function(e,t){return"<h3>"+e+" seconden</h3>"}},{key:"componentDidMount",value:function(){console.log("componentDidMount"),this.start()}},{key:"buildTable",value:function(){var e="<Table>";return this.vertreklanen.forEach(function(t){e+="<Table.Row>",e+="<Table.HeaderCell>"+t+"</Table.HeaderCell>",this.vertreklanen[t].forEach(function(t){e+="<Table.Cell>"+t+"</Table.Cell>"}),e+="</Table.Row>"}),e+="</Table>"}},{key:"render",value:function(){console.log("render");var e=this.state.laneValues,t=this;return r.a.createElement("div",{className:"Drawer"},r.a.createElement(m.a,null,r.a.createElement(m.a.Header,null,r.a.createElement(m.a.Row,null,r.a.createElement(m.a.HeaderCell,null,"From Lane:"),r.a.createElement(m.a.HeaderCell,null,"To Lanes:"))),r.a.createElement(m.a.Body,null,Object.keys(this.vertreklanen).map(function(a){return r.a.createElement(m.a.Row,null,r.a.createElement(m.a.Cell,null,a,":",t.lanes[a]),Object.keys(t.vertreklanen[a]).map(function(n){var l=e[a][n]?e[a][n][1]:"fail",s=e[a][n]?e[a][n][0]:"fail";return"https://w3id.org/opentrafficlights/thesauri/signalphase/2"===l||"https://w3id.org/opentrafficlights/thesauri/signalphase/3"===l?r.a.createElement(m.a.Cell,null,n,":",t.lanes[n],r.a.createElement("p",{style:{color:"red"}},s)):"https://w3id.org/opentrafficlights/thesauri/signalphase/5"===l||"https://w3id.org/opentrafficlights/thesauri/signalphase/6"===l?r.a.createElement(m.a.Cell,null,n,":",t.lanes[n],r.a.createElement("p",{style:{color:"green"}},s)):r.a.createElement(m.a.Cell,null,n,":",t.lanes[n],r.a.createElement("p",{style:{color:"orange"}},s))}))}))))}}]),t}(n.Component)),T=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("img",{src:f.a,className:"App-logo",alt:"logo"}),r.a.createElement(k,null)))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[126,1,2]]]);
//# sourceMappingURL=main.41dacd80.chunk.js.map